{% extends 'base.html' %}
{% block content %}
{% load static %}

<link rel="stylesheet" href="{% static "css/table.css" %}">

<div class="row">
    <div class="col m9 s9">
        <p class="right-align flow-text against-text">
        <span class="pol-text">{{shown_cand.name}}</span> 후보가<br/>
        <span class="promise-text">{{shown_promise.title}}</span>를<br/>
        공약으로 제시했습니다
        </p>
    </div>
    <div class="col m2 s3 center">
        <img src="{{shown_cand.profile}}" class="pol-img">
    </div>
</div>

<div class="row">
    <div class="col m10 offset-m1 s12 center">
        <blockquote class="instruction-text">
            <p class="light left-align flow-text">
            상대 후보의 공약과 관련된,
            <span class="my-pol-text pol-text">{{selected_cand.name}}</span> 후보의 공약을 골라주세요
            </p>
        </blockquote>
    </div>
</div>

<div class="row">
    <div class="col m3 offset-m1 s4 center">
        <img src="{{selected_cand.profile}}" class="pol-img my-pol">
    </div>

    <div class="col m7 s8">
        <div class="card grey lighten-4">
            <div class="card-content grey-text text-darken-3 select-promise">
                <div class="collection">
                    {% for p in selected_promises %}
                    <a id="pid-{{p.pid}}" href="#benefit-modal" class="collection-item modal-trigger">
                        {{p.title}}
                    </a>
                    {% endfor %}
                </div>
            </div>
            <div class="card-action center-align">
                <a href="#">상대 후보 공약과 관련있는 공약을 못 찾겠습니다</a>
            </div>
        </div>
    </div>
</div>

<!-- Modal Structure -->
<div id="benefit-modal" class="modal modal-fixed-footer">
    <div class="modal-content">
        <h4 id="modal-title"></h4>
        <h5 class="flow-text">{{prompt}}</h5>

        <form method="POST">
            {% csrf_token %}
            <div class="row">
                {% for field in prompt_form %}
                <div class="col s6">
                    <p>{{field.help_text}}</p>
                    {% for choice in field %}
                    <p>{{ choice.tag }}
                    <label for="{{ choice.id_for_label }}">{{ choice.choice_label }}</label>
                    </p>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>

            <div class="row i-center-align">
                <button class="btn waves-effect waves-light" type="submit">
                    답변을 전송합니다 <i class="material-icons right">send</i>
                </button>
            </div>
        </form>
    </div>

    <div class="modal-footer i-center-align">
        <a href="#!"
           class="modal-action modal-close waves-effect btn-flat deep-orange-text waves-orange">
            나에게 이득을 주지 않습니다
        </a>
    </div>
</div>

<script>
$(document).ready(() => {
    $('.modal').modal();
});

var promises = {{selected_promises_json|safe}};
promises = promises.map((x) => JSON.parse(x));

$(".modal-trigger").click((e) => {
    var pid = e.currentTarget.id.split("-")[1];
    var selected = promises.filter((x) => {return x.pid == pid})[0];
    $("#modal-title").text(selected.title);
});
</script>

{% endblock %}
